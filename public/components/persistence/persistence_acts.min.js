m.persistence.acts({save_code(t,e){return t.act.save_id_to_localstorage({document_id:t.act.get_document_id()}),localStorage.setObject("code",m.editor.act.get_value())},load_code(t,e){t.act.get_document_id()&&localStorage.getObject("code")},set_initial_state(t,e){t.act.load_code().length?m.editor.act.set_value({value:t.act.load_code()}):m.editor.act.set_default_text()},get_document_id(t,e){if(m.persistence.document_id)return m.persistence.document_id;const o=t.act.find_document_id_from_url(),n=t.act.get_id_from_localstorage();if(!o&&!n){const e=t.act.generate_a_new_document_id();return t.act.save_id_to_localstorage({document_id:e}),t.act.save_to_file({data:t.act.load_code()}),e}if(!o&&n)return history.replaceState(null,n,`/${n}`),n;o&&(t.act.save_id_to_localstorage({document_id:o}),t.act.load_from_file().then(e=>{m.editor.act.set_value({value:e}),t.act.save_code()}))},priv:{load_from_file(t,e){return new Promise((e,o)=>{var n=new XMLHttpRequest;n.open("GET",`/document/${t.act.get_document_id()}`,!0),n.onload=function(){this.status>=200&&this.status<400?e(this.response):o("Could not load URL")},n.onerror=function(){o("Could not load URL")},n.send()})},save_to_file(t,e){var o=new XMLHttpRequest;o.open("POST",`/document/${t.act.get_document_id()}`,!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e.data))},find_document_id_from_url(t,e){const o=location.pathname.match(/\/([\d\w]+)/);return o&&o.length>=2&&o[1]?o[1]:null},generate_a_new_document_id(t,e){return parseInt(`${Math.floor(1e3*Math.random())}${Date.now()}`).toString(36)},get_id_from_localstorage(t,e){return localStorage.getItem("document_id")},save_id_to_localstorage(t,e){return m.persistence.document_id=e.document_id,localStorage.setItem("document_id",e.document_id)}}}),m.persistence.document_id=null;