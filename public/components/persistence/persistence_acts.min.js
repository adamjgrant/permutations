m.persistence.acts({save_code(t,e){t.act.save_id_to_localstorage({document_id:t.act.get_document_id()}),t.act.set_url_to_id({id:t.act.get_document_id()}),t.act.save_to_file({data:m.editor.act.get_value()})},load_code_from_localhost(t,e){return null},set_initial_state(t,e){const o=t.act.load_code_from_localhost();t.act.get_document_id()?t.act.load_from_file().then(t=>{o!==t&&m.editor.act.set_value(t)}):(console.log("No document ID found"),m.editor.act.set_default_text())},set_url_to_id(t,e){if(!e.id)return history.replaceState(null,"New Document","/");history.replaceState(null,e.id,`/${e.id}`)},get_document_id(t,e){if(m.persistence.document_id)return m.persistence.document_id;const o=t.act.find_document_id_from_url(),n=t.act.get_id_from_localstorage();if(!o&&!n){const e=t.act.generate_a_new_document_id();return t.act.save_id_to_localstorage({document_id:e}),t.act.save_to_file({data:m.editor.act.get_value()}),t.act.set_url_to_id({id:t.act.get_id_from_localstorage()}),e}return!o&&n?(t.act.set_url_to_id({id:t.act.get_id_from_localstorage()}),n):o?(t.act.save_id_to_localstorage({document_id:o}),t.act.load_from_file().then(e=>{m.editor.act.set_value({value:e}),t.act.save_code()}),o):void 0},load_from_file(t,e){return new Promise((e,o)=>{var n=new XMLHttpRequest;t.act.get_document_id()||o("No document ID provided"),n.open("GET",`/document/${t.act.get_document_id()}`,!0),n.onload=function(){this.status>=200&&this.status<400?e(this.response):o("Could not load URL")},n.onerror=function(){o("Could not load URL")},n.send()})},clear_local_storage(t,e){m.persistence.document_id=null,localStorage.removeItem("document_id"),localStorage.removeItem("code")},priv:{save_to_file(t,e){if(t.act.get_document_id()){const n=JSON.stringify(e.data);var o=new XMLHttpRequest;o.open("POST",`/document/${t.act.get_document_id()}`,!0),o.setRequestHeader("Content-Type","text/plain"),o.send(n),o.onerror=(t=>{return t})}},find_document_id_from_url(t,e){const o=location.pathname.match(/\/([\d\w]+)/);return o&&o.length>=2&&o[1]?o[1]:null},generate_a_new_document_id(t,e){return parseInt(`${Math.floor(1e3*Math.random())}${Date.now()}`).toString(36)},get_id_from_localstorage(t,e){return localStorage.getItem("document_id")},save_id_to_localstorage(t,e){return m.persistence.document_id=e.document_id,localStorage.setItem("document_id",e.document_id)}}}),m.persistence.document_id=null;